apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - https://github.com/jaberchez/demo-kustomize-bases/app/deployment?ref=main
  - https://github.com/jaberchez/demo-kustomize-bases/app/service?ref=main
  - https://github.com/jaberchez/demo-kustomize-bases/app/route?ref=main

commonLabels:
  app: demo-webserver

namespace: demo-webserver

patches:
  - patch: |-
      - op: replace
        path: /metadata/name
        value: demo-webserver
    target:
      kind: Deployment
      name: "base-name"

  - patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/name
        value: demo-webserver
    target:
      kind: Deployment
      name: "base-name"

  - patch: |-
      - op: replace
        path: /metadata/name
        value: demo-webserver
    target:
      kind: Service
      name: "base-name"

  - patch: |-
      - op: replace
        path: /metadata/name
        value: demo-webserver
    target:
      kind: Route
      name: "base-name"

  - patch: |-
      - op: replace
        path: /spec/host
        value: demo-webserver.apps.cluster01.sandbox1759.opentlc.com
    target:
      kind: Route
      name: "base-name"

  - patch: |-
      - op: replace
        path: /spec/to/name
        value: demo-webserver
    target:
      kind: Route
      name: "base-name"

images:
  - name: base-image
    newName: quay.io/jberchez-redhat/demo-webserver
    newTag: v1.0

